import Ue,{useState as Ee,useCallback as Pe,forwardRef as we}from"react";import Ae from"next/image";import{pollForProcessingImage as de}from"@cloudinary-util/util";import{transformationPlugins as _e}from"@cloudinary-util/url-loader";import{constructCloudinaryUrl as Oe}from"@cloudinary-util/url-loader";import he from"next/package.json";var ee={name:"next-cloudinary",version:"6.16.2",license:"MIT",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup",dev:"tsup --watch",prepublishOnly:"cp ../README.md . && cp ../LICENSE . && pnpm build",postpublish:"rm ./README.md && rm ./LICENSE",test:"vitest run","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" pnpm build && cd tests/nextjs-app && npm install && npm run build',"test:watch":"vitest"},dependencies:{"@cloudinary-util/types":"1.5.10","@cloudinary-util/url-loader":"5.10.4","@cloudinary-util/util":"4.0.0"},devDependencies:{"@babel/core":"^7.25.2","@babel/preset-env":"^7.25.3","@tsconfig/recommended":"^1.0.7","@types/node":"^22.0.2","@types/react":"^18.3.3","@types/react-dom":"^18.3.0",dotenv:"^16.4.5",mkdirp:"^3.0.1",tsup:"^8.2.3",typescript:"^5.5.4",vitest:"^2.0.5"},peerDependencies:{next:"^12 || ^13 || ^14 || >=15.0.0-rc || ^15",react:"^17 || ^18 || >=19.0.0-beta || ^19"}};var te="A",oe="V",re=ie(he.version),ne=ie(ee.version);function ie(e){let t=e;return t.includes("-")&&(t=t.split("-")[0]),t}function P(e){let t=e?.cloud?.cloudName??process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;if(!t)throw new Error("A Cloudinary Cloud name is required, please make sure NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME is set and configured in your environment.");let a=e?.cloud?.apiKey??process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,l=e?.url?.secureDistribution??process.env.NEXT_PUBLIC_CLOUDINARY_SECURE_DISTRIBUTION,o=e?.url?.privateCdn??process.env.NEXT_PUBLIC_CLOUDINARY_PRIVATE_CDN;return Object.assign({cloud:{...e?.cloud,apiKey:a,cloudName:t},url:{...e?.url,secureDistribution:l,privateCdn:o}},e)}function Y(e){return Object.assign({product:te,sdkCode:oe,sdkSemver:ne,techVersion:re,feature:""},e)}function b(e,t,a){return Oe({options:e,config:P(t),analytics:Y(a)})}function z({loaderOptions:e,imageProps:t,cldOptions:a,cldConfig:l={}}){let o={...t,...a};if(o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height,typeof e?.width=="number"&&typeof o.width=="number"&&e.width!==o.width){let r=e.width/o.width;o.width=e.width,typeof o.height=="number"&&(o.height=Math.floor(o.height*r))}else typeof e?.width=="number"&&typeof o?.width!="number"&&(o.width=e?.width);return b(o,l)}var xe=we(function(t,a){let l=!1,o=["assetType","config","deliveryType","strictTransformations"];_e.forEach(({props:n})=>{Object.keys(n).forEach(y=>{if(o.includes(y))throw new Error(`Option ${y} already exists!`);o.push(y)})});let r={alt:t.alt,src:t.src};Object.keys(t).filter(n=>typeof n=="string"&&!o.includes(n)).forEach(n=>r[n]=t[n]);let p=Object.keys(r).map(n=>`${n}:${r[n]}`).join(";"),[I,m]=Ee(p),d={};o.forEach(n=>{let g=t[n];g&&(d[n]=g)});let s=process.env.__NEXT_IMAGE_OPTS||{};(t.unoptimized===!0||s?.unoptimized===!0)&&(r.src=b({...d,width:r.width,height:r.height,src:r.src,format:"default",quality:"default"},t.config));async function w(n){let g=!0;if(l)return;if(l=!0,typeof t.onError=="function"){let U=t.onError(n);typeof U=="boolean"&&U===!1&&(g=!1)}else typeof t.onError=="boolean"&&t.onError===!1&&(g=!1);if(g===!1)return;let y=n.target,O=await de({src:y.src});typeof O.error=="string"&&process.env.NODE_ENV==="development"&&console.error(`[CldImage] Failed to load image ${t.src}: ${O.error}`),O.success&&m(`${p};${Date.now()}`)}let A=Pe(w,[de,p]),u=Ae;return"default"in u&&(u=u.default),Ue.createElement(u,{key:I,...r,loader:n=>z({loaderOptions:n,imageProps:r,cldOptions:d,cldConfig:t.config}),onError:A,ref:a})}),ae=xe;import E from"react";import Le from"next/head";function $(e){return b({...e,format:e.format||"jpg",width:e.width||1200,height:e.height||627,crop:e.crop||{type:"fill",gravity:"center",source:!0}})}var ve="summary_large_image",Te=({excludeTags:e=[],twitterTitle:t,keys:a={},...l})=>{let{alt:o}=l,{width:r=1200,height:p=627}=l;r=typeof r=="string"?parseInt(r):r,p=typeof p=="string"?parseInt(p):p;let I=$({...l,width:r,height:p}),m=$({...l,width:r,height:p,format:l.format||"webp"}),d={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...a};return E.createElement(Le,null,E.createElement("meta",{key:d["og:image"],property:"og:image",content:I}),E.createElement("meta",{key:d["og:image:secure_url"],property:"og:image:secure_url",content:I}),E.createElement("meta",{key:d["og:image:width"],property:"og:image:width",content:`${r}`}),E.createElement("meta",{key:d["og:image:height"],property:"og:image:height",content:`${p}`}),o&&E.createElement("meta",{key:d["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&E.createElement("meta",{key:d["twitter:title"],property:"twitter:title",content:t||" "}),E.createElement("meta",{key:d["twitter:card"],property:"twitter:card",content:ve}),E.createElement("meta",{key:d["twitter:image"],property:"twitter:image",content:m}))},le=Te;import X from"react";import K,{useState as Q,useEffect as pe,useRef as ce}from"react";import be from"next/script";import{generateSignatureCallback as Ne,generateUploadWidgetResultCallback as We,getUploadWidgetOptions as Me,UPLOAD_WIDGET_EVENTS as De}from"@cloudinary-util/url-loader";function se(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Se=({children:e,config:t,onError:a,onOpen:l,onUpload:o,options:r,signatureEndpoint:p,uploadPreset:I,...m})=>{let d=ce(),s=ce(),[w,A]=Q(void 0),[u,n]=Q(void 0),[g,y]=Q(!0),O=P(t),U=p&&Ne({signatureEndpoint:String(p),fetch}),D=Me({uploadPreset:I||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,uploadSignature:U,...r},O),W=We({onError:i=>{A(i),typeof a=="function"&&a(i,{widget:s.current,...f})},onResult:i=>{if(typeof i?.event!="string")return;n(i);let h=De[i.event];if(typeof h=="string"&&typeof m[h]=="function"){let B=m[h];B(i,{widget:s.current,...f})}let j=`${h}Action`;if(j&&typeof m[j]=="function"){let B=m[j];B(i)}}});pe(()=>{if(typeof u>"u")return;u.event==="success"&&typeof o=="function"&&(process.env.NODE_ENV==="development"&&console.warn("The onUpload callback is deprecated. Please use onSuccess instead."),o(u,s.current))},[u]);function S(){y(!1),d.current||(d.current=window.cloudinary),se(()=>{s.current||(s.current=T())})}pe(()=>()=>{s.current?.destroy(),s.current=void 0},[]);function c(i,h=[]){if(s.current||(s.current=T()),typeof s?.current[i]=="function")return s.current[i](...h)}function V(i){c("close",[i])}function C(i){return c("destroy",[i])}function _(){c("hide")}function x(){return c("isDestroyed")}function L(){return c("isMinimized")}function k(){return c("isShowing")}function M(){c("minimize")}function v(i,h){c("open",[i,h]),typeof l=="function"&&l(s.current)}function G(){c("show")}function R(){c("update")}let f={close:V,destroy:C,hide:_,isDestroyed:x,isMinimized:L,isShowing:k,minimize:M,open:v,show:G,update:R};function T(){return d.current?.createUploadWidget(D,W)}return K.createElement(K.Fragment,null,typeof e=="function"&&e({cloudinary:d.current,widget:s.current,results:u,error:w,isLoading:g,...f}),K.createElement(be,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://upload-widget.cloudinary.com/global/all.js",onLoad:S,onError:i=>console.error(`Failed to load Cloudinary Upload Widget: ${i.message}`)}))},H=Se;var Ve=({className:e,children:t,onClick:a,onError:l,onOpen:o,onUpload:r,onAbort:p,onBatchCancelled:I,onClose:m,onDisplayChanged:d,onPublicId:s,onQueuesEnd:w,onQueuesStart:A,onRetry:u,onShowCompleted:n,onSourceChanged:g,onSuccess:y,onTags:O,onUploadAdded:U,options:D,signatureEndpoint:W,uploadPreset:S,onAbortAction:c,onBatchCancelledAction:V,onCloseAction:C,onDisplayChangedAction:_,onPublicIdAction:x,onQueuesEndAction:L,onQueuesStartAction:k,onRetryAction:M,onShowCompletedAction:v,onSourceChangedAction:G,onSuccessAction:R,onTagsAction:f,onUploadAddedAction:T,...i})=>X.createElement(X.Fragment,null,X.createElement(H,{onError:l,onOpen:o,onUpload:r,onAbort:p,onBatchCancelled:I,onClose:m,onDisplayChanged:d,onPublicId:s,onQueuesEnd:w,onQueuesStart:A,onRetry:u,onShowCompleted:n,onSourceChanged:g,onSuccess:y,onTags:O,onUploadAdded:U,options:D,signatureEndpoint:W,uploadPreset:S,onAbortAction:c,onBatchCancelledAction:V,onCloseAction:C,onDisplayChangedAction:_,onPublicIdAction:x,onQueuesEndAction:L,onQueuesStartAction:k,onRetryAction:M,onShowCompletedAction:v,onSourceChangedAction:G,onSuccessAction:R,onTagsAction:f,onUploadAddedAction:T},({open:h,isLoading:j})=>{function B(Z){Z.preventDefault(),h(),typeof a=="function"&&a(Z)}return X.createElement("button",{...i,className:e||"",onClick:B,disabled:j},t||"Upload")})),ue=Ve;import N,{useRef as J,useEffect as ge,useId as ke,useState as fe}from"react";import Ge from"next/script";import Re from"next/head";import{getVideoPlayerOptions as je}from"@cloudinary-util/url-loader";var me=[],ye="1.11.1",Be=e=>{let{className:t,config:a,height:l,id:o,onDataLoad:r,onError:p,onMetadataLoad:I,onPause:m,onPlay:d,onEnded:s,width:w}=e,A=ke(),[u,n]=fe(!1),[g,y]=fe(!1),O=P(a),U=je(e,O),{publicId:D}=U;if(typeof D>"u")throw new Error("Video Player requires a Public ID or Cloudinary URL - please specify a src prop");let W=J(),S=J(),c=e.videoRef||S,V=J(),C=e.playerRef||V,_=o||`player-${A.replace(/:/g,"")}`,x="cld-video-player cld-fluid";t&&(x=`${x} ${t}`);let L={error:p,loadeddata:r,loadedmetadata:I,pause:m,play:d,ended:s};function k(f){let T=L[f.type];typeof T=="function"&&T(R())}let M=()=>{C.current?.videojs?.cloudinary&&C.current.videojs.cloudinary.dispose(),me=me.filter(f=>f!==_),C.current=null,y(!1)},v=()=>{typeof window<"u"&&"cloudinary"in window&&c.current&&!g&&(W.current=window.cloudinary,C.current&&M(),C.current=W.current.videoPlayer(c.current,U),y(!0),Object.keys(L).forEach(f=>{typeof L[f]=="function"&&C.current?.on(f,k)}))};function G(){n(!0),"cloudinary"in window&&v()}ge(()=>(u&&typeof window<"u"&&"cloudinary"in window&&v(),()=>{M()}),[]),ge(()=>{u&&!g&&typeof window<"u"&&"cloudinary"in window&&v()},[u,g]);function R(){return{player:C.current,video:c.current}}return N.createElement(N.Fragment,null,N.createElement(Re,null,N.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${ye}/dist/cld-video-player.min.css`,rel:"stylesheet"})),N.createElement("div",{style:{width:"100%"}},N.createElement("video",{ref:c,id:_,className:x,width:w,height:l}),N.createElement(Ge,{id:`cloudinary-videoplayer-${_}`,src:`https://unpkg.com/cloudinary-video-player@${ye}/dist/cld-video-player.min.js`,onLoad:G,onError:f=>console.error(`Failed to load Cloudinary Video Player: ${f.message}`)})))},Ce=Be;import{constructCloudinaryUrl as Ye}from"@cloudinary-util/url-loader";function $e(e,t,a){return Ye({options:{assetType:"video",format:"auto:video",...e},config:P(t),analytics:Y(a)})}export{ae as CldImage,le as CldOgImage,ue as CldUploadButton,H as CldUploadWidget,Ce as CldVideoPlayer,z as cloudinaryLoader,b as getCldImageUrl,$ as getCldOgImageUrl,$e as getCldVideoUrl};
//# sourceMappingURL=index.mjs.map