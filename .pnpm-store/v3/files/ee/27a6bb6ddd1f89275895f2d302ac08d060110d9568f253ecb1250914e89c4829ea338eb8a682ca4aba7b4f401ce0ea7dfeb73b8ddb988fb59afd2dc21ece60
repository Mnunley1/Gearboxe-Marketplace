"use strict";var Le=Object.create;var K=Object.defineProperty;var ve=Object.getOwnPropertyDescriptor;var Te=Object.getOwnPropertyNames;var be=Object.getPrototypeOf,Ne=Object.prototype.hasOwnProperty;var We=(e,t)=>{for(var r in t)K(e,r,{get:t[r],enumerable:!0})},ae=(e,t,r,d)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Te(t))!Ne.call(e,o)&&o!==r&&K(e,o,{get:()=>t[o],enumerable:!(d=ve(t,o))||d.enumerable});return e};var O=(e,t,r)=>(r=e!=null?Le(be(e)):{},ae(t||!e||!e.__esModule?K(r,"default",{value:e,enumerable:!0}):r,e)),Me=e=>ae(K({},"__esModule",{value:!0}),e);var Be={};We(Be,{CldImage:()=>ee,CldOgImage:()=>re,CldUploadButton:()=>ne,CldUploadWidget:()=>F,CldVideoPlayer:()=>ie,cloudinaryLoader:()=>J,getCldImageUrl:()=>x,getCldOgImageUrl:()=>z,getCldVideoUrl:()=>xe});module.exports=Me(Be);var L=O(require("react")),ye=O(require("next/image")),Z=require("@cloudinary-util/util"),Ce=require("@cloudinary-util/url-loader");var me=require("@cloudinary-util/url-loader");var se=O(require("next/package.json"));var le={name:"next-cloudinary",version:"6.16.2",license:"MIT",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup",dev:"tsup --watch",prepublishOnly:"cp ../README.md . && cp ../LICENSE . && pnpm build",postpublish:"rm ./README.md && rm ./LICENSE",test:"vitest run","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" pnpm build && cd tests/nextjs-app && npm install && npm run build',"test:watch":"vitest"},dependencies:{"@cloudinary-util/types":"1.5.10","@cloudinary-util/url-loader":"5.10.4","@cloudinary-util/util":"4.0.0"},devDependencies:{"@babel/core":"^7.25.2","@babel/preset-env":"^7.25.3","@tsconfig/recommended":"^1.0.7","@types/node":"^22.0.2","@types/react":"^18.3.3","@types/react-dom":"^18.3.0",dotenv:"^16.4.5",mkdirp:"^3.0.1",tsup:"^8.2.3",typescript:"^5.5.4",vitest:"^2.0.5"},peerDependencies:{next:"^12 || ^13 || ^14 || >=15.0.0-rc || ^15",react:"^17 || ^18 || >=19.0.0-beta || ^19"}};var pe="A",ce="V",ue=fe(se.default.version),ge=fe(le.version);function fe(e){let t=e;return t.includes("-")&&(t=t.split("-")[0]),t}function _(e){let t=e?.cloud?.cloudName??process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME;if(!t)throw new Error("A Cloudinary Cloud name is required, please make sure NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME is set and configured in your environment.");let r=e?.cloud?.apiKey??process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,d=e?.url?.secureDistribution??process.env.NEXT_PUBLIC_CLOUDINARY_SECURE_DISTRIBUTION,o=e?.url?.privateCdn??process.env.NEXT_PUBLIC_CLOUDINARY_PRIVATE_CDN;return Object.assign({cloud:{...e?.cloud,apiKey:r,cloudName:t},url:{...e?.url,secureDistribution:d,privateCdn:o}},e)}function Q(e){return Object.assign({product:pe,sdkCode:ce,sdkSemver:ge,techVersion:ue,feature:""},e)}function x(e,t,r){return(0,me.constructCloudinaryUrl)({options:e,config:_(t),analytics:Q(r)})}function J({loaderOptions:e,imageProps:t,cldOptions:r,cldConfig:d={}}){let o={...t,...r};if(o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height,typeof e?.width=="number"&&typeof o.width=="number"&&e.width!==o.width){let n=e.width/o.width;o.width=e.width,typeof o.height=="number"&&(o.height=Math.floor(o.height*n))}else typeof e?.width=="number"&&typeof o?.width!="number"&&(o.width=e?.width);return x(o,d)}var Se=(0,L.forwardRef)(function(t,r){let d=!1,o=["assetType","config","deliveryType","strictTransformations"];Ce.transformationPlugins.forEach(({props:i})=>{Object.keys(i).forEach(I=>{if(o.includes(I))throw new Error(`Option ${I} already exists!`);o.push(I)})});let n={alt:t.alt,src:t.src};Object.keys(t).filter(i=>typeof i=="string"&&!o.includes(i)).forEach(i=>n[i]=t[i]);let c=Object.keys(n).map(i=>`${i}:${n[i]}`).join(";"),[U,C]=(0,L.useState)(c),l={};o.forEach(i=>{let f=t[i];f&&(l[i]=f)});let p=process.env.__NEXT_IMAGE_OPTS||{};(t.unoptimized===!0||p?.unoptimized===!0)&&(n.src=x({...l,width:n.width,height:n.height,src:n.src,format:"default",quality:"default"},t.config));async function T(i){let f=!0;if(d)return;if(d=!0,typeof t.onError=="function"){let A=t.onError(i);typeof A=="boolean"&&A===!1&&(f=!1)}else typeof t.onError=="boolean"&&t.onError===!1&&(f=!1);if(f===!1)return;let I=i.target,w=await(0,Z.pollForProcessingImage)({src:I.src});typeof w.error=="string"&&process.env.NODE_ENV==="development"&&console.error(`[CldImage] Failed to load image ${t.src}: ${w.error}`),w.success&&C(`${c};${Date.now()}`)}let b=(0,L.useCallback)(T,[Z.pollForProcessingImage,c]),g=ye.default;return"default"in g&&(g=g.default),L.default.createElement(g,{key:U,...n,loader:i=>J({loaderOptions:i,imageProps:n,cldOptions:l,cldConfig:t.config}),onError:b,ref:r})}),ee=Se;var P=O(require("react")),Ie=O(require("next/head"));function z(e){return x({...e,format:e.format||"jpg",width:e.width||1200,height:e.height||627,crop:e.crop||{type:"fill",gravity:"center",source:!0}})}var Ve="summary_large_image",ke=({excludeTags:e=[],twitterTitle:t,keys:r={},...d})=>{let{alt:o}=d,{width:n=1200,height:c=627}=d;n=typeof n=="string"?parseInt(n):n,c=typeof c=="string"?parseInt(c):c;let U=z({...d,width:n,height:c}),C=z({...d,width:n,height:c,format:d.format||"webp"}),l={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...r};return P.default.createElement(Ie.default,null,P.default.createElement("meta",{key:l["og:image"],property:"og:image",content:U}),P.default.createElement("meta",{key:l["og:image:secure_url"],property:"og:image:secure_url",content:U}),P.default.createElement("meta",{key:l["og:image:width"],property:"og:image:width",content:`${n}`}),P.default.createElement("meta",{key:l["og:image:height"],property:"og:image:height",content:`${c}`}),o&&P.default.createElement("meta",{key:l["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&P.default.createElement("meta",{key:l["twitter:title"],property:"twitter:title",content:t||" "}),P.default.createElement("meta",{key:l["twitter:card"],property:"twitter:card",content:Ve}),P.default.createElement("meta",{key:l["twitter:image"],property:"twitter:image",content:C}))},re=ke;var q=O(require("react"));var y=O(require("react")),Oe=O(require("next/script")),v=require("@cloudinary-util/url-loader");function he(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Ge=({children:e,config:t,onError:r,onOpen:d,onUpload:o,options:n,signatureEndpoint:c,uploadPreset:U,...C})=>{let l=(0,y.useRef)(),p=(0,y.useRef)(),[T,b]=(0,y.useState)(void 0),[g,i]=(0,y.useState)(void 0),[f,I]=(0,y.useState)(!0),w=_(t),A=c&&(0,v.generateSignatureCallback)({signatureEndpoint:String(c),fetch}),G=(0,v.getUploadWidgetOptions)({uploadPreset:U||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,uploadSignature:A,...n},w),V=(0,v.generateUploadWidgetResultCallback)({onError:a=>{b(a),typeof r=="function"&&r(a,{widget:p.current,...m})},onResult:a=>{if(typeof a?.event!="string")return;i(a);let E=v.UPLOAD_WIDGET_EVENTS[a.event];if(typeof E=="string"&&typeof C[E]=="function"){let X=C[E];X(a,{widget:p.current,...m})}let H=`${E}Action`;if(H&&typeof C[H]=="function"){let X=C[H];X(a)}}});(0,y.useEffect)(()=>{if(typeof g>"u")return;g.event==="success"&&typeof o=="function"&&(process.env.NODE_ENV==="development"&&console.warn("The onUpload callback is deprecated. Please use onSuccess instead."),o(g,p.current))},[g]);function R(){I(!1),l.current||(l.current=window.cloudinary),he(()=>{p.current||(p.current=S())})}(0,y.useEffect)(()=>()=>{p.current?.destroy(),p.current=void 0},[]);function u(a,E=[]){if(p.current||(p.current=S()),typeof p?.current[a]=="function")return p.current[a](...E)}function j(a){u("close",[a])}function h(a){return u("destroy",[a])}function N(){u("hide")}function W(){return u("isDestroyed")}function M(){return u("isMinimized")}function B(){return u("isShowing")}function k(){u("minimize")}function D(a,E){u("open",[a,E]),typeof d=="function"&&d(p.current)}function Y(){u("show")}function $(){u("update")}let m={close:j,destroy:h,hide:N,isDestroyed:W,isMinimized:M,isShowing:B,minimize:k,open:D,show:Y,update:$};function S(){return l.current?.createUploadWidget(G,V)}return y.default.createElement(y.default.Fragment,null,typeof e=="function"&&e({cloudinary:l.current,widget:p.current,results:g,error:T,isLoading:f,...m}),y.default.createElement(Oe.default,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://upload-widget.cloudinary.com/global/all.js",onLoad:R,onError:a=>console.error(`Failed to load Cloudinary Upload Widget: ${a.message}`)}))},F=Ge;var Re=({className:e,children:t,onClick:r,onError:d,onOpen:o,onUpload:n,onAbort:c,onBatchCancelled:U,onClose:C,onDisplayChanged:l,onPublicId:p,onQueuesEnd:T,onQueuesStart:b,onRetry:g,onShowCompleted:i,onSourceChanged:f,onSuccess:I,onTags:w,onUploadAdded:A,options:G,signatureEndpoint:V,uploadPreset:R,onAbortAction:u,onBatchCancelledAction:j,onCloseAction:h,onDisplayChangedAction:N,onPublicIdAction:W,onQueuesEndAction:M,onQueuesStartAction:B,onRetryAction:k,onShowCompletedAction:D,onSourceChangedAction:Y,onSuccessAction:$,onTagsAction:m,onUploadAddedAction:S,...a})=>q.default.createElement(q.default.Fragment,null,q.default.createElement(F,{onError:d,onOpen:o,onUpload:n,onAbort:c,onBatchCancelled:U,onClose:C,onDisplayChanged:l,onPublicId:p,onQueuesEnd:T,onQueuesStart:b,onRetry:g,onShowCompleted:i,onSourceChanged:f,onSuccess:I,onTags:w,onUploadAdded:A,options:G,signatureEndpoint:V,uploadPreset:R,onAbortAction:u,onBatchCancelledAction:j,onCloseAction:h,onDisplayChangedAction:N,onPublicIdAction:W,onQueuesEndAction:M,onQueuesStartAction:B,onRetryAction:k,onShowCompletedAction:D,onSourceChangedAction:Y,onSuccessAction:$,onTagsAction:m,onUploadAddedAction:S},({open:E,isLoading:H})=>{function X(de){de.preventDefault(),E(),typeof r=="function"&&r(de)}return q.default.createElement("button",{...a,className:e||"",onClick:X,disabled:H},t||"Upload")})),ne=Re;var s=O(require("react")),Pe=O(require("next/script")),we=O(require("next/head")),Ae=require("@cloudinary-util/url-loader");var Ue=[],Ee="1.11.1",je=e=>{let{className:t,config:r,height:d,id:o,onDataLoad:n,onError:c,onMetadataLoad:U,onPause:C,onPlay:l,onEnded:p,width:T}=e,b=(0,s.useId)(),[g,i]=(0,s.useState)(!1),[f,I]=(0,s.useState)(!1),w=_(r),A=(0,Ae.getVideoPlayerOptions)(e,w),{publicId:G}=A;if(typeof G>"u")throw new Error("Video Player requires a Public ID or Cloudinary URL - please specify a src prop");let V=(0,s.useRef)(),R=(0,s.useRef)(),u=e.videoRef||R,j=(0,s.useRef)(),h=e.playerRef||j,N=o||`player-${b.replace(/:/g,"")}`,W="cld-video-player cld-fluid";t&&(W=`${W} ${t}`);let M={error:c,loadeddata:n,loadedmetadata:U,pause:C,play:l,ended:p};function B(m){let S=M[m.type];typeof S=="function"&&S($())}let k=()=>{h.current?.videojs?.cloudinary&&h.current.videojs.cloudinary.dispose(),Ue=Ue.filter(m=>m!==N),h.current=null,I(!1)},D=()=>{typeof window<"u"&&"cloudinary"in window&&u.current&&!f&&(V.current=window.cloudinary,h.current&&k(),h.current=V.current.videoPlayer(u.current,A),I(!0),Object.keys(M).forEach(m=>{typeof M[m]=="function"&&h.current?.on(m,B)}))};function Y(){i(!0),"cloudinary"in window&&D()}(0,s.useEffect)(()=>(g&&typeof window<"u"&&"cloudinary"in window&&D(),()=>{k()}),[]),(0,s.useEffect)(()=>{g&&!f&&typeof window<"u"&&"cloudinary"in window&&D()},[g,f]);function $(){return{player:h.current,video:u.current}}return s.default.createElement(s.default.Fragment,null,s.default.createElement(we.default,null,s.default.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${Ee}/dist/cld-video-player.min.css`,rel:"stylesheet"})),s.default.createElement("div",{style:{width:"100%"}},s.default.createElement("video",{ref:u,id:N,className:W,width:T,height:d}),s.default.createElement(Pe.default,{id:`cloudinary-videoplayer-${N}`,src:`https://unpkg.com/cloudinary-video-player@${Ee}/dist/cld-video-player.min.js`,onLoad:Y,onError:m=>console.error(`Failed to load Cloudinary Video Player: ${m.message}`)})))},ie=je;var _e=require("@cloudinary-util/url-loader");function xe(e,t,r){return(0,_e.constructCloudinaryUrl)({options:{assetType:"video",format:"auto:video",...e},config:_(t),analytics:Q(r)})}0&&(module.exports={CldImage,CldOgImage,CldUploadButton,CldUploadWidget,CldVideoPlayer,cloudinaryLoader,getCldImageUrl,getCldOgImageUrl,getCldVideoUrl});
//# sourceMappingURL=index.js.map